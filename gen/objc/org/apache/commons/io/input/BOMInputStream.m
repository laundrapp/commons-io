//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/marcussmith/temp/commons-io/src/main/java/org/apache/commons/io/input/BOMInputStream.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/InputStream.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/util/Arrays.h"
#include "java/util/Comparator.h"
#include "java/util/List.h"
#include "java/util/function/Function.h"
#include "java/util/function/ToDoubleFunction.h"
#include "java/util/function/ToIntFunction.h"
#include "java/util/function/ToLongFunction.h"
#include "org/apache/commons/io/ByteOrderMark.h"
#include "org/apache/commons/io/input/BOMInputStream.h"
#include "org/apache/commons/io/input/ProxyInputStream.h"

#pragma clang diagnostic ignored "-Wprotocol"

@interface OrgApacheCommonsIoInputBOMInputStream () {
 @public
  jboolean include_;
  /*!
   @brief BOMs are sorted from longest to shortest.
   */
  id<JavaUtilList> boms_;
  OrgApacheCommonsIoByteOrderMark *byteOrderMark_;
  IOSIntArray *firstBytes_;
  jint fbLength_;
  jint fbIndex_;
  jint markFbIndex_;
  jboolean markedAtStart_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheCommonsIoInputBOMInputStream, boms_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(OrgApacheCommonsIoInputBOMInputStream, byteOrderMark_, OrgApacheCommonsIoByteOrderMark *)
J2OBJC_FIELD_SETTER(OrgApacheCommonsIoInputBOMInputStream, firstBytes_, IOSIntArray *)

/*!
 @brief Compares ByteOrderMark objects in descending length order.
 */
inline id<JavaUtilComparator> OrgApacheCommonsIoInputBOMInputStream_get_ByteOrderMarkLengthComparator(void);
static id<JavaUtilComparator> OrgApacheCommonsIoInputBOMInputStream_ByteOrderMarkLengthComparator;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgApacheCommonsIoInputBOMInputStream, ByteOrderMarkLengthComparator, id<JavaUtilComparator>)

__attribute__((unused)) static jint OrgApacheCommonsIoInputBOMInputStream_readFirstBytes(OrgApacheCommonsIoInputBOMInputStream *self);

__attribute__((unused)) static OrgApacheCommonsIoByteOrderMark *OrgApacheCommonsIoInputBOMInputStream_find(OrgApacheCommonsIoInputBOMInputStream *self);

__attribute__((unused)) static jboolean OrgApacheCommonsIoInputBOMInputStream_matchesWithOrgApacheCommonsIoByteOrderMark_(OrgApacheCommonsIoInputBOMInputStream *self, OrgApacheCommonsIoByteOrderMark *bom);

@interface OrgApacheCommonsIoInputBOMInputStream_1 : NSObject < JavaUtilComparator >

- (jint)compareWithId:(OrgApacheCommonsIoByteOrderMark *)bom1
               withId:(OrgApacheCommonsIoByteOrderMark *)bom2;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheCommonsIoInputBOMInputStream_1)

__attribute__((unused)) static void OrgApacheCommonsIoInputBOMInputStream_1_init(OrgApacheCommonsIoInputBOMInputStream_1 *self);

__attribute__((unused)) static OrgApacheCommonsIoInputBOMInputStream_1 *new_OrgApacheCommonsIoInputBOMInputStream_1_init(void) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheCommonsIoInputBOMInputStream_1 *create_OrgApacheCommonsIoInputBOMInputStream_1_init(void);

J2OBJC_INITIALIZED_DEFN(OrgApacheCommonsIoInputBOMInputStream)

@implementation OrgApacheCommonsIoInputBOMInputStream

- (instancetype)initWithJavaIoInputStream:(JavaIoInputStream *)delegate {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_(self, delegate);
  return self;
}

- (instancetype)initWithJavaIoInputStream:(JavaIoInputStream *)delegate
                              withBoolean:(jboolean)include {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_(self, delegate, include);
  return self;
}

- (instancetype)initWithJavaIoInputStream:(JavaIoInputStream *)delegate
 withOrgApacheCommonsIoByteOrderMarkArray:(IOSObjectArray *)boms {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withOrgApacheCommonsIoByteOrderMarkArray_(self, delegate, boms);
  return self;
}

- (instancetype)initWithJavaIoInputStream:(JavaIoInputStream *)delegate
                              withBoolean:(jboolean)include
 withOrgApacheCommonsIoByteOrderMarkArray:(IOSObjectArray *)boms {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(self, delegate, include, boms);
  return self;
}

- (jboolean)hasBOM {
  return [self getBOM] != nil;
}

- (jboolean)hasBOMWithOrgApacheCommonsIoByteOrderMark:(OrgApacheCommonsIoByteOrderMark *)bom {
  if (![((id<JavaUtilList>) nil_chk(boms_)) containsWithId:bom]) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$@", @"Stream not configure to detect ", bom));
  }
  return byteOrderMark_ != nil && [((OrgApacheCommonsIoByteOrderMark *) nil_chk([self getBOM])) isEqual:bom];
}

- (OrgApacheCommonsIoByteOrderMark *)getBOM {
  if (firstBytes_ == nil) {
    fbLength_ = 0;
    jint maxBomSize = [((OrgApacheCommonsIoByteOrderMark *) nil_chk([((id<JavaUtilList>) nil_chk(boms_)) getWithInt:0])) length];
    JreStrongAssignAndConsume(&firstBytes_, [IOSIntArray newArrayWithLength:maxBomSize]);
    for (jint i = 0; i < firstBytes_->size_; i++) {
      *IOSIntArray_GetRef(firstBytes_, i) = [((JavaIoInputStream *) nil_chk(JreLoadVolatileId(&in_))) read];
      fbLength_++;
      if (IOSIntArray_Get(nil_chk(firstBytes_), i) < 0) {
        break;
      }
    }
    JreStrongAssign(&byteOrderMark_, OrgApacheCommonsIoInputBOMInputStream_find(self));
    if (byteOrderMark_ != nil) {
      if (!include_) {
        if ([byteOrderMark_ length] < ((IOSIntArray *) nil_chk(firstBytes_))->size_) {
          fbIndex_ = [((OrgApacheCommonsIoByteOrderMark *) nil_chk(byteOrderMark_)) length];
        }
        else {
          fbLength_ = 0;
        }
      }
    }
  }
  return byteOrderMark_;
}

- (NSString *)getBOMCharsetName {
  [self getBOM];
  return byteOrderMark_ == nil ? nil : [byteOrderMark_ getCharsetName];
}

- (jint)read {
  jint b = OrgApacheCommonsIoInputBOMInputStream_readFirstBytes(self);
  return b >= 0 ? b : [((JavaIoInputStream *) nil_chk(JreLoadVolatileId(&in_))) read];
}

- (jint)readWithByteArray:(IOSByteArray *)buf
                  withInt:(jint)off
                  withInt:(jint)len {
  jint firstCount = 0;
  jint b = 0;
  while (len > 0 && b >= 0) {
    b = OrgApacheCommonsIoInputBOMInputStream_readFirstBytes(self);
    if (b >= 0) {
      *IOSByteArray_GetRef(nil_chk(buf), off++) = (jbyte) (b & (jint) 0xFF);
      len--;
      firstCount++;
    }
  }
  jint secondCount = [((JavaIoInputStream *) nil_chk(JreLoadVolatileId(&in_))) readWithByteArray:buf withInt:off withInt:len];
  return secondCount < 0 ? firstCount > 0 ? firstCount : -1 : firstCount + secondCount;
}

- (jint)readWithByteArray:(IOSByteArray *)buf {
  return [self readWithByteArray:buf withInt:0 withInt:((IOSByteArray *) nil_chk(buf))->size_];
}

- (void)markWithInt:(jint)readlimit {
  @synchronized(self) {
    markFbIndex_ = fbIndex_;
    markedAtStart_ = (firstBytes_ == nil);
    [((JavaIoInputStream *) nil_chk(JreLoadVolatileId(&in_))) markWithInt:readlimit];
  }
}

- (void)reset {
  @synchronized(self) {
    fbIndex_ = markFbIndex_;
    if (markedAtStart_) {
      JreStrongAssign(&firstBytes_, nil);
    }
    [((JavaIoInputStream *) nil_chk(JreLoadVolatileId(&in_))) reset];
  }
}

- (jlong)skipWithLong:(jlong)n {
  while (n > 0 && OrgApacheCommonsIoInputBOMInputStream_readFirstBytes(self) >= 0) {
    n--;
  }
  return [((JavaIoInputStream *) nil_chk(JreLoadVolatileId(&in_))) skipWithLong:n];
}

- (void)dealloc {
  RELEASE_(boms_);
  RELEASE_(byteOrderMark_);
  RELEASE_(firstBytes_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [OrgApacheCommonsIoInputBOMInputStream class]) {
    JreStrongAssignAndConsume(&OrgApacheCommonsIoInputBOMInputStream_ByteOrderMarkLengthComparator, new_OrgApacheCommonsIoInputBOMInputStream_1_init());
    J2OBJC_SET_INITIALIZED(OrgApacheCommonsIoInputBOMInputStream)
  }
}

@end

void OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_(OrgApacheCommonsIoInputBOMInputStream *self, JavaIoInputStream *delegate) {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(self, delegate, false, [IOSObjectArray arrayWithObjects:(id[]){ JreLoadStatic(OrgApacheCommonsIoByteOrderMark, UTF_8) } count:1 type:OrgApacheCommonsIoByteOrderMark_class_()]);
}

OrgApacheCommonsIoInputBOMInputStream *new_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_(JavaIoInputStream *delegate) {
  J2OBJC_NEW_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_, delegate)
}

OrgApacheCommonsIoInputBOMInputStream *create_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_(JavaIoInputStream *delegate) {
  J2OBJC_CREATE_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_, delegate)
}

void OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_(OrgApacheCommonsIoInputBOMInputStream *self, JavaIoInputStream *delegate, jboolean include) {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(self, delegate, include, [IOSObjectArray arrayWithObjects:(id[]){ JreLoadStatic(OrgApacheCommonsIoByteOrderMark, UTF_8) } count:1 type:OrgApacheCommonsIoByteOrderMark_class_()]);
}

OrgApacheCommonsIoInputBOMInputStream *new_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_(JavaIoInputStream *delegate, jboolean include) {
  J2OBJC_NEW_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_withBoolean_, delegate, include)
}

OrgApacheCommonsIoInputBOMInputStream *create_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_(JavaIoInputStream *delegate, jboolean include) {
  J2OBJC_CREATE_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_withBoolean_, delegate, include)
}

void OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withOrgApacheCommonsIoByteOrderMarkArray_(OrgApacheCommonsIoInputBOMInputStream *self, JavaIoInputStream *delegate, IOSObjectArray *boms) {
  OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(self, delegate, false, boms);
}

OrgApacheCommonsIoInputBOMInputStream *new_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withOrgApacheCommonsIoByteOrderMarkArray_(JavaIoInputStream *delegate, IOSObjectArray *boms) {
  J2OBJC_NEW_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_withOrgApacheCommonsIoByteOrderMarkArray_, delegate, boms)
}

OrgApacheCommonsIoInputBOMInputStream *create_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withOrgApacheCommonsIoByteOrderMarkArray_(JavaIoInputStream *delegate, IOSObjectArray *boms) {
  J2OBJC_CREATE_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_withOrgApacheCommonsIoByteOrderMarkArray_, delegate, boms)
}

void OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(OrgApacheCommonsIoInputBOMInputStream *self, JavaIoInputStream *delegate, jboolean include, IOSObjectArray *boms) {
  OrgApacheCommonsIoInputProxyInputStream_initWithJavaIoInputStream_(self, delegate);
  if (boms == nil || boms->size_ == 0) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"No BOMs specified");
  }
  self->include_ = include;
  JavaUtilArrays_sortWithNSObjectArray_withJavaUtilComparator_(boms, OrgApacheCommonsIoInputBOMInputStream_ByteOrderMarkLengthComparator);
  JreStrongAssign(&self->boms_, JavaUtilArrays_asListWithNSObjectArray_(boms));
}

OrgApacheCommonsIoInputBOMInputStream *new_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(JavaIoInputStream *delegate, jboolean include, IOSObjectArray *boms) {
  J2OBJC_NEW_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_, delegate, include, boms)
}

OrgApacheCommonsIoInputBOMInputStream *create_OrgApacheCommonsIoInputBOMInputStream_initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_(JavaIoInputStream *delegate, jboolean include, IOSObjectArray *boms) {
  J2OBJC_CREATE_IMPL(OrgApacheCommonsIoInputBOMInputStream, initWithJavaIoInputStream_withBoolean_withOrgApacheCommonsIoByteOrderMarkArray_, delegate, include, boms)
}

jint OrgApacheCommonsIoInputBOMInputStream_readFirstBytes(OrgApacheCommonsIoInputBOMInputStream *self) {
  [self getBOM];
  return self->fbIndex_ < self->fbLength_ ? IOSIntArray_Get(nil_chk(self->firstBytes_), self->fbIndex_++) : -1;
}

OrgApacheCommonsIoByteOrderMark *OrgApacheCommonsIoInputBOMInputStream_find(OrgApacheCommonsIoInputBOMInputStream *self) {
  for (OrgApacheCommonsIoByteOrderMark * __strong bom in nil_chk(self->boms_)) {
    if (OrgApacheCommonsIoInputBOMInputStream_matchesWithOrgApacheCommonsIoByteOrderMark_(self, bom)) {
      return bom;
    }
  }
  return nil;
}

jboolean OrgApacheCommonsIoInputBOMInputStream_matchesWithOrgApacheCommonsIoByteOrderMark_(OrgApacheCommonsIoInputBOMInputStream *self, OrgApacheCommonsIoByteOrderMark *bom) {
  for (jint i = 0; i < [((OrgApacheCommonsIoByteOrderMark *) nil_chk(bom)) length]; i++) {
    if ([bom getWithInt:i] != IOSIntArray_Get(nil_chk(self->firstBytes_), i)) {
      return false;
    }
  }
  return true;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheCommonsIoInputBOMInputStream)

@implementation OrgApacheCommonsIoInputBOMInputStream_1

- (jint)compareWithId:(OrgApacheCommonsIoByteOrderMark *)bom1
               withId:(OrgApacheCommonsIoByteOrderMark *)bom2 {
  jint len1 = [((OrgApacheCommonsIoByteOrderMark *) nil_chk(bom1)) length];
  jint len2 = [((OrgApacheCommonsIoByteOrderMark *) nil_chk(bom2)) length];
  if (len1 > len2) {
    return -1;
  }
  if (len2 > len1) {
    return 1;
  }
  return 0;
}

- (id<JavaUtilComparator>)reversed {
  return JavaUtilComparator_reversed(self);
}

- (id<JavaUtilComparator>)thenComparingWithJavaUtilComparator:(id<JavaUtilComparator>)arg0 {
  return JavaUtilComparator_thenComparingWithJavaUtilComparator_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingWithJavaUtilFunctionFunction:(id<JavaUtilFunctionFunction>)arg0
                                             withJavaUtilComparator:(id<JavaUtilComparator>)arg1 {
  return JavaUtilComparator_thenComparingWithJavaUtilFunctionFunction_withJavaUtilComparator_(self, arg0, arg1);
}

- (id<JavaUtilComparator>)thenComparingWithJavaUtilFunctionFunction:(id<JavaUtilFunctionFunction>)arg0 {
  return JavaUtilComparator_thenComparingWithJavaUtilFunctionFunction_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingIntWithJavaUtilFunctionToIntFunction:(id<JavaUtilFunctionToIntFunction>)arg0 {
  return JavaUtilComparator_thenComparingIntWithJavaUtilFunctionToIntFunction_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingLongWithJavaUtilFunctionToLongFunction:(id<JavaUtilFunctionToLongFunction>)arg0 {
  return JavaUtilComparator_thenComparingLongWithJavaUtilFunctionToLongFunction_(self, arg0);
}

- (id<JavaUtilComparator>)thenComparingDoubleWithJavaUtilFunctionToDoubleFunction:(id<JavaUtilFunctionToDoubleFunction>)arg0 {
  return JavaUtilComparator_thenComparingDoubleWithJavaUtilFunctionToDoubleFunction_(self, arg0);
}

@end

void OrgApacheCommonsIoInputBOMInputStream_1_init(OrgApacheCommonsIoInputBOMInputStream_1 *self) {
  NSObject_init(self);
}

OrgApacheCommonsIoInputBOMInputStream_1 *new_OrgApacheCommonsIoInputBOMInputStream_1_init() {
  J2OBJC_NEW_IMPL(OrgApacheCommonsIoInputBOMInputStream_1, init)
}

OrgApacheCommonsIoInputBOMInputStream_1 *create_OrgApacheCommonsIoInputBOMInputStream_1_init() {
  J2OBJC_CREATE_IMPL(OrgApacheCommonsIoInputBOMInputStream_1, init)
}
